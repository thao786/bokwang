<!DOCTYPE html>
<html lang="en">
<head>
	<title>Bokwang Centre - View document</title>  
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
</head>
<body>


<div class="page-header">
  <h1 class="text-success">Search for an user <small>Fill one of the space below</small></h1>
</div>

<form action="/search" method="post">
	<div class="form-group">
    	<label for="exampleInputEmail1">First Name</label>
    	<input type="email" class="form-control" name="fname" placeholder="Enter first name">
  	</div>
  	<div class="form-group">
    	<label for="exampleInputPassword1">Last Name</label>
    	<input type="password" class="form-control" name="lname" placeholder="Enter last name">
  	</div>
  	<div class="form-group">
    	<label for="exampleInputPassword1">Email</label>
    	<input type="password" class="form-control" name="email" placeholder="Enter email">
  	</div>
  	<div class="form-group">
    	<label for="exampleInputPassword1">Part of Comment</label>
    	<input type="password" class="form-control" name="comment" placeholder="Enter comments">
  	</div>
	<button type="submit" class="btn btn-success" name="submit" value="Search">Submit</button>
</form>

</br></br>


%{
	(def users 
  		(let [query (str "select * from users")
  				conn 	(DriverManager/getConnection l/bokwang-db-url)
  				stmt 	(.createStatement conn)
				user-list (resultset-seq (.executeQuery stmt query))
				dummy 	(.close conn)]
  			user-list))

  	(defn get-user-column [column]
  		(str "<td>" column "</td>"))

  	(defn get-user-row [user]
  		(let [full-name (str (user :fname) " " (user :lname))
  				edit-url (str l/edit-user-path (user :userid))
  				bokwang-profile (str "<a href='" edit-url "'>" full-name "</a>")
  				fb-link (str "<a href='" (user :fb_profile) "'>facebook</a>")
  				fb-icon-tag (str "<a href='" (user :fb_profile) "'><img src='http://lotus-zen.com/btn/fb-icon.png'></a>")
  				
  				update-btn (str "<a href='" edit-url "'>edit</a>")]
	  		(str "<tr>" (get-user-column (str bokwang-profile " " fb-icon-tag))
	  			(get-user-column (user :level))
	  			(get-user-column (user :email))
	  			(get-user-column (user :phone))
				(get-user-column (user :comment))
	  				"</tr>")))
	nil
}


<div class="page-header">
  <h1 class="text-success">List of all users</h1>
</div>
<table class="table table-hover table-striped table-responsive">
	<tr>
		<th>Name</th>
		<th>Level</th>
		<th>Email</th>
		<th>Phone</th>
		<th>Comment</th>
	</tr>

	%{ (apply str (map get-user-row users)) }
</table>

<br><br>

</body>
</html>


