<!DOCTYPE html>
<html lang="en">
<head>
	<title>Bokwang Centre - view document</title>  
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
</head>
<body>

<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>


<p> Search for an user </p>

<form action="/search" method="post">
    First Name: <input type="text" name="fname"/> or Last Name: <input type="text" name="lname"/> or <br>
    Email: <input type="text" name="email"/> or part of Comment: <input type="text" name="comment"/>
    <input type="submit" name="submit" value="Search" />
</form>

</br></br>


%{
	(def users 
  		(let [query (str "select * from users")
  				conn 	(DriverManager/getConnection l/bokwang-db-url)
  				stmt 	(.createStatement conn)
				user-list (resultset-seq (.executeQuery stmt query))
				dummy 	(.close conn)]
  			user-list))

  	(defn get-user-column [column]
  		(str "<td>" column "</td>"))

  	(defn get-user-row [user]
  		(let [full-name (str (user :fname) " " (user :lname))
  				edit-url (str l/edit-user-path (user :userid))
  				bokwang-profile (str "<a href='" edit-url "'>" full-name "</a>")
  				fb-link (str "<a href='" (user :fb_profile) "'>facebook</a>")
  				fb-icon-tag (str "<a href='" (user :fb_profile) "'><img src='http://lotus-zen.com/btn/fb-icon.png'></a>")
  				
  				update-btn (str "<a href='" edit-url "'>edit</a>")]
	  		(str "<tr>" (get-user-column (str bokwang-profile " " fb-icon-tag))
	  			(get-user-column (user :level))
	  			(get-user-column (user :email))
	  			(get-user-column (user :phone))
				(get-user-column (user :comment))
	  				"</tr>")))
	nil
}


<p> List of all users </p>
<table border="1">
	<tr>
		<td>Name</td>
		<td>Level</td>
		<td>Email</td>
		<td>Phone</td>
		<td>Comment</td>
	</tr>

	%{ (apply str (map get-user-row users)) }
</table>

</body>
</html>


