%{(require 
           '[sodahead.render :as r]
           '[bokwang.lib :as l])

	(import '(java.sql DriverManager))
}

<!DOCTYPE html>
<html lang="en">
<head>
	<title>Bokwang Centre - view document</title>  
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
</head>
<body>

%{
	(def doc-id (params :doc-id))
	
	(def doc 
  		(let [query (str "select * from doc where doc_id = '" doc-id "'")
  				conn 	(DriverManager/getConnection l/bokwang-db-url)
  				stmt 	(.createStatement conn)
				documents (resultset-seq (.executeQuery stmt query))
				dummy 	(.close conn)]
  			(first documents)))
  	nil
}

<p> %(doc :title) </p>
<p> </p>
<p>category: %(doc :category) </p>
<p>level: %(doc :level) </p>
<p>upload date: %(doc :upload_date) </p> </br>

<p>%(doc :content) </p>


<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
<h1>edit a document</h1>
<p>you can upload a file and/or paste the content here</p>

<div id="error"> </div>

<!-- Place inside the <head> of your HTML -->
<script src="http://cdn.ckeditor.com/4.4.6/standard/ckeditor.js"></script>


<img id="upload-pic-link" onclick="upload_pic();" src="http://lotus-zen.com/btn/upload-pic-btn.png"/>
<input id="insertImgInput" onchange="insertAjax()" name="insertImgInput" type="file" style="display:none"/><br>



<form action="/upload" method="post" enctype="multipart/form-data">
    Category:
    <input type="checkbox" name="category" value="zen">zen
    <input type="checkbox" name="category" value="qigong">qigong
    <input type="text" name="category-other"/> Other<br>

  	document title <input type="text" name="title" placeholder="document title"/><br>

  	<textarea name="content" id="editor1" rows="10" cols="80"></textarea>

    <input name="file" type="file"/><br>
    <input type="submit" name="submit" value="submit" />
</form>


<script>
CKEDITOR.replace( 'editor1', {
    height: '500', 
    width: '1000',
    on: {
    	instanceReady: function() {
           // this is current editor instance
           //this.insertHtml('<h1>someText</h1>');
       	}
    }
});

function upload_pic (){
    $("#insertImgInput").click();
}

function insertAjax (){
    var file = document.getElementById("insertImgInput");
    var fd = new FormData();    
    fd.append( 'file', file.files[0] );

    $.ajax({
        url: 'http://lotus-zen.com/file',
        data: fd,
        processData: false,
        contentType: false,
        type: 'POST',
        success: function(data){
            $("#error").html("");

            if (data.charAt(0) == '<'){
               CKEDITOR.instances.editor1.insertHtml(data);
            }
            else{
                $("#error").html(data);
            }
        }
    });
}




</script>
















</body>
</html>
