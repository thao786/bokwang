%{(require 
           '[sodahead.render :as r]
           '[bokwang.lib :as l])

	(import '(java.sql DriverManager))
}

<!DOCTYPE html>
<html lang="en">
<head>
	<title>Bokwang Centre - view document</title>  
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
</head>
<body>

%{
	(def doc-id (params :doc-id))
	
	(def doc 
  		(let [query (str "select * from doc where doc_id = '" doc-id "'")
  				conn 	(DriverManager/getConnection l/bokwang-db-url)
  				stmt 	(.createStatement conn)
				documents (resultset-seq (.executeQuery stmt query))
				dummy 	(.close conn)]
  			(first documents)))

  	(def content (clojure.string/replace (doc :content) #"\r\n" ""))

  	nil
}

<p> </p>

<p>upload date: %(doc :upload_date) </p> </br>


%include {"private/doc-upload.html"}




<script>
$("#doc_title").val("%(doc :title)");
$("#doc_level").val("%(doc :level)");

var hidden_id_input = '<input id="%(doc :doc_id)" type="text" name="doc_id" style="display:none" value="%(doc :doc_id)"/>';
$("#upload_form").append(hidden_id_input);

CKEDITOR.on('instanceReady', 
	function(){ 
		CKEDITOR.instances.editor1.insertHtml('%content');
	}); 
</script>


</body>
</html>
