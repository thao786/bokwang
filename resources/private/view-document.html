%{(require 
           '[sodahead.render :as r]
           '[taoensso.carmine :as car :refer (wcar)]
           '[bokwang.lib :as l])

	(import '(java.sql DriverManager))
}

<!DOCTYPE html>
<html lang="en">
<head>
	<title>Bokwang Centre - view document</title>  
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
</head>
<body>

%{
	(def doc-id (params :doc-id))
	(def cookie (params :cookie))
	
	(def doc 
  		(let [query (str "select * from doc where doc_id = '" doc-id "'")
  				conn 	(DriverManager/getConnection l/bokwang-db-url)
  				stmt 	(.createStatement conn)
				documents (resultset-seq (.executeQuery stmt query))
				dummy 	(.close conn)]
  			(first documents)))

  	(def edit-url (str l/edit-doc-path doc-id))

	(defmacro wcar* [& body] `(car/wcar l/server1-conn ~@body))

  	nil
}

%{
	(let [edit-url (str l/edit-doc-path (doc :doc_id))
          edit-link (str "<a href='" edit-url "'>edit</a>")]
		edit-link)

(wcar* (car/set  "foo" "bar"))

}
(wcar* (car/get cookie))

<p> %(doc :title) </p>
<p> </p>
<p>category: %(doc :category) </p>
<p>level: %(doc :level) </p>
<p>upload date: %(doc :upload_date) </p> </br>

<p>%(doc :content) </p>

</body>
</html>
